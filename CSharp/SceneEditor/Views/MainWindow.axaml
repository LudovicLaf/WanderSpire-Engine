<!-- File: CSharp/SceneEditor/Views/MainWindow.axaml -->
<Window x:Class="SceneEditor.Views.MainWindow"
        xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:SceneEditor.ViewModels"
        xmlns:converters="using:SceneEditor.Converters"
        xmlns:ids="using:Dock.Settings"
        x:DataType="vm:MainWindowViewModel"
        Title="{Binding Title}"
        Width="1400"
        Height="900"
        Icon="/Resources/Icons/editor.ico"
        Background="{DynamicResource AppBackgroundBrush}"
        ids:DockProperties.IsDragEnabled="True"
        ids:DockProperties.IsDropEnabled="True">

	<Window.Resources>
		<converters:BoolToVisibilityConverter x:Key="BoolToVisibility"/>
		<converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibility"/>
		<converters:BoolToColorConverter x:Key="BoolToColorConverter"/>
		<converters:EngineStatusConverter x:Key="EngineStatusConverter"/>
	</Window.Resources>

	<DockPanel>

		<!-- Menu Bar -->
		<Menu DockPanel.Dock="Top" Background="{DynamicResource HeaderBackgroundBrush}">
			<MenuItem Header="_File">
				<MenuItem Header="_New Scene" Command="{Binding NewSceneCommand}" InputGesture="Ctrl+N">
					<MenuItem.Icon>
						<TextBlock Text="{StaticResource IconNew}" FontFamily="{StaticResource FontAwesome}" FontSize="12"/>
					</MenuItem.Icon>
				</MenuItem>
				<MenuItem Header="_Open Scene..." Command="{Binding OpenSceneCommand}" InputGesture="Ctrl+O">
					<MenuItem.Icon>
						<TextBlock Text="{StaticResource IconOpen}" FontFamily="{StaticResource FontAwesome}" FontSize="12"/>
					</MenuItem.Icon>
				</MenuItem>
				<Separator/>
				<MenuItem Header="_Save Scene" Command="{Binding SaveSceneCommand}" InputGesture="Ctrl+S">
					<MenuItem.Icon>
						<TextBlock Text="{StaticResource IconSave}" FontFamily="{StaticResource FontAwesome}" FontSize="12"/>
					</MenuItem.Icon>
				</MenuItem>
				<MenuItem Header="Save Scene _As..." Command="{Binding SaveSceneAsCommand}" InputGesture="Ctrl+Shift+S"/>
				<Separator/>
				<MenuItem Header="E_xit" Command="{Binding ExitCommand}" InputGesture="Alt+F4"/>
			</MenuItem>

			<MenuItem Header="_Edit">
				<MenuItem Header="_Undo" Command="{Binding UndoCommand}" InputGesture="Ctrl+Z">
					<MenuItem.Icon>
						<TextBlock Text="{StaticResource IconUndo}" FontFamily="{StaticResource FontAwesome}" FontSize="12"/>
					</MenuItem.Icon>
				</MenuItem>
				<MenuItem Header="_Redo" Command="{Binding RedoCommand}" InputGesture="Ctrl+Y">
					<MenuItem.Icon>
						<TextBlock Text="{StaticResource IconRedo}" FontFamily="{StaticResource FontAwesome}" FontSize="12"/>
					</MenuItem.Icon>
				</MenuItem>
			</MenuItem>

			<MenuItem Header="_Scene">
				<MenuItem Header="_Play" Command="{Binding PlaySceneCommand}" InputGesture="F5">
					<MenuItem.Icon>
						<TextBlock Text="{StaticResource IconPlay}" FontFamily="{StaticResource FontAwesome}" FontSize="12"/>
					</MenuItem.Icon>
				</MenuItem>
				<MenuItem Header="_Pause" Command="{Binding PauseSceneCommand}">
					<MenuItem.Icon>
						<TextBlock Text="{StaticResource IconPause}" FontFamily="{StaticResource FontAwesome}" FontSize="12"/>
					</MenuItem.Icon>
				</MenuItem>
				<MenuItem Header="_Stop" Command="{Binding StopSceneCommand}">
					<MenuItem.Icon>
						<TextBlock Text="{StaticResource IconStop}" FontFamily="{StaticResource FontAwesome}" FontSize="12"/>
					</MenuItem.Icon>
				</MenuItem>
			</MenuItem>

			<MenuItem Header="_View">
				<MenuItem Header="Toggle _Dark Theme" Name="ToggleThemeMenuItem" Click="ToggleTheme_Click">
					<MenuItem.Icon>
						<TextBlock x:Name="MenuThemeIcon" Text="🌙" FontSize="12"/>
					</MenuItem.Icon>
				</MenuItem>
				<Separator/>
				<MenuItem Header="_Reset Layout" Command="{Binding ResetLayoutCommand}"/>
				<Separator/>
				<MenuItem Header="GameObjects" IsChecked="True"/>
				<MenuItem Header="Inspector" IsChecked="True"/>
				<MenuItem Header="Assets" IsChecked="True"/>
				<MenuItem Header="Toolbox" IsChecked="True"/>
				<MenuItem Header="Viewport" IsChecked="True"/>
			</MenuItem>

			<MenuItem Header="_Help">
				<MenuItem Header="About WanderSpire"/>
				<MenuItem Header="Documentation"/>
				<MenuItem Header="Report Bug"/>
			</MenuItem>
		</Menu>

		<!-- Modern Toolbar -->
		<Border DockPanel.Dock="Top" Classes="Header">
			<Grid ColumnDefinitions="*,Auto">
				<!-- Left: Main Tools -->
				<StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="6">
					<Button Classes="Icon" Command="{Binding NewSceneCommand}" ToolTip.Tip="New Scene (Ctrl+N)">
						<TextBlock Text="{StaticResource IconNew}" FontFamily="{StaticResource FontAwesome}" FontSize="14"/>
					</Button>
					<Button Classes="Icon" Command="{Binding OpenSceneCommand}" ToolTip.Tip="Open Scene (Ctrl+O)">
						<TextBlock Text="{StaticResource IconOpen}" FontFamily="{StaticResource FontAwesome}" FontSize="14"/>
					</Button>
					<Button Classes="Icon" Command="{Binding SaveSceneCommand}" ToolTip.Tip="Save Scene (Ctrl+S)">
						<TextBlock Text="{StaticResource IconSave}" FontFamily="{StaticResource FontAwesome}" FontSize="14"/>
					</Button>

					<Separator Classes="Vertical" Height="24" Margin="6,0"/>

					<Button Classes="Icon" Command="{Binding UndoCommand}" ToolTip.Tip="Undo (Ctrl+Z)">
						<TextBlock Text="{StaticResource IconUndo}" FontFamily="{StaticResource FontAwesome}" FontSize="14"/>
					</Button>
					<Button Classes="Icon" Command="{Binding RedoCommand}" ToolTip.Tip="Redo (Ctrl+Y)">
						<TextBlock Text="{StaticResource IconRedo}" FontFamily="{StaticResource FontAwesome}" FontSize="14"/>
					</Button>

					<Separator Classes="Vertical" Height="24" Margin="6,0"/>

					<Button Classes="Primary" Command="{Binding PlaySceneCommand}" ToolTip.Tip="Play Scene (F5)" Padding="16,6">
						<StackPanel Orientation="Horizontal" Spacing="6">
							<TextBlock Text="{StaticResource IconPlay}" FontFamily="{StaticResource FontAwesome}" FontSize="12"/>
							<TextBlock Text="Play"/>
						</StackPanel>
					</Button>
					<Button Classes="Icon" Command="{Binding PauseSceneCommand}" ToolTip.Tip="Pause Scene">
						<TextBlock Text="{StaticResource IconPause}" FontFamily="{StaticResource FontAwesome}" FontSize="14"/>
					</Button>
					<Button Classes="Icon" Command="{Binding StopSceneCommand}" ToolTip.Tip="Stop Scene">
						<TextBlock Text="{StaticResource IconStop}" FontFamily="{StaticResource FontAwesome}" FontSize="14"/>
					</Button>
				</StackPanel>

				<!-- Right: Theme Toggle and Layout -->
				<StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="6">
					<Button Classes="Icon" Name="ThemeToggleButton" ToolTip.Tip="Toggle Dark/Light Theme" Click="ToggleTheme_Click">
						<TextBlock x:Name="ThemeIcon" Text="🌙" FontSize="14"/>
					</Button>
					<Button Classes="Secondary" Command="{Binding ResetLayoutCommand}" ToolTip.Tip="Reset Docking Layout" Padding="8,6">
						<TextBlock Text="Reset Layout" FontSize="12"/>
					</Button>
				</StackPanel>
			</Grid>
		</Border>

		<!-- Status Bar -->
		<Border DockPanel.Dock="Bottom" Classes="StatusBar">
			<Grid ColumnDefinitions="*,Auto,Auto,Auto">
				<!-- Status Text -->
				<TextBlock Grid.Column="0" Text="{Binding StatusText}" VerticalAlignment="Center" Foreground="{DynamicResource PrimaryTextBrush}"/>

				<!-- Engine Status -->
				<StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" Margin="16,0">
					<TextBlock Text="{Binding IsInitialized, Converter={StaticResource EngineStatusConverter}}"
							   VerticalAlignment="Center"
							   Foreground="{DynamicResource SecondaryTextBrush}"
							   FontSize="12"/>
					<Ellipse Width="8" Height="8"
							 Fill="{Binding IsInitialized, Converter={StaticResource BoolToColorConverter}}"
							 VerticalAlignment="Center"/>
				</StackPanel>

				<!-- Additional Status Info -->
				<TextBlock Grid.Column="2"
						   Text="Ready"
						   VerticalAlignment="Center"
						   Foreground="{DynamicResource SecondaryTextBrush}"
						   FontSize="12"
						   Margin="16,0"/>

				<!-- Theme Indicator -->
				<TextBlock Grid.Column="3"
						   x:Name="ThemeStatusText"
						   Text="Light Theme"
						   VerticalAlignment="Center"
						   Foreground="{DynamicResource SecondaryTextBrush}"
						   FontSize="10"
						   Margin="16,0"/>
			</Grid>
		</Border>

		<!-- Main Docking Layout -->
		<DockControl x:Name="DockControl"
					 Layout="{Binding Layout}"
					 Margin="4"
					 Background="{DynamicResource AppBackgroundBrush}"/>

		<!-- Debug Layout Info (Remove in production) -->
		<Border IsVisible="False" Background="#80FF0000" HorizontalAlignment="Right" VerticalAlignment="Bottom"
				Padding="8" Margin="8" CornerRadius="4">
			<TextBlock x:Name="LayoutDebugInfo" Text="Layout: Not Loaded" Foreground="White" FontSize="10"/>
		</Border>

		<!-- Loading Overlay -->
		<Border IsVisible="{Binding IsInitialized, Converter={StaticResource InverseBoolToVisibility}}"
				Background="#C0000000"
				ZIndex="1000">
			<Border HorizontalAlignment="Center" VerticalAlignment="Center"
					Classes="Card"
					Background="{DynamicResource CardBackgroundBrush}"
					Padding="40"
					MaxWidth="400">
				<StackPanel Spacing="20">
					<ProgressBar IsIndeterminate="True"
								 Height="4"
								 CornerRadius="2"
								 Background="{DynamicResource PanelBackgroundBrush}"
								 Foreground="{DynamicResource SelectionBackgroundBrush}"/>
					<StackPanel Spacing="8">
						<TextBlock Text="Initializing WanderSpire Scene Editor"
								   HorizontalAlignment="Center"
								   FontSize="16"
								   FontWeight="Medium"
								   Foreground="{DynamicResource PrimaryTextBrush}"/>
						<TextBlock Text="{Binding StatusText}"
								   HorizontalAlignment="Center"
								   FontSize="12"
								   Foreground="{DynamicResource SecondaryTextBrush}"/>
					</StackPanel>
				</StackPanel>
			</Border>
		</Border>
	</DockPanel>

	<!-- Window-level Styles -->
	<Window.Styles>
		<!-- Enhanced Button Styles -->
		<Style Selector="Button">
			<Setter Property="Transitions">
				<Transitions>
					<BrushTransition Property="Background" Duration="0:0:0.15"/>
					<BrushTransition Property="BorderBrush" Duration="0:0:0.15"/>
				</Transitions>
			</Setter>
		</Style>

		<Style Selector="Button:disabled">
			<Setter Property="Opacity" Value="0.5"/>
		</Style>

		<!-- Enhanced GridSplitter Styles -->
		<Style Selector="GridSplitter">
			<Setter Property="Transitions">
				<Transitions>
					<BrushTransition Property="Background" Duration="0:0:0.15"/>
				</Transitions>
			</Setter>
		</Style>

		<!-- Enhanced Separator Styles -->
		<Style Selector="Separator">
			<Setter Property="Background" Value="{DynamicResource DividerBrush}"/>
		</Style>

		<Style Selector="Separator.Vertical">
			<Setter Property="Width" Value="1"/>
			<Setter Property="Margin" Value="4,0"/>
		</Style>

		<Style Selector="Separator.Horizontal">
			<Setter Property="Height" Value="1"/>
			<Setter Property="Margin" Value="0,4"/>
		</Style>

		<!-- Loading Animation -->
		<Style Selector="ProgressBar">
			<Setter Property="Transitions">
				<Transitions>
					<DoubleTransition Property="Value" Duration="0:0:0.3"/>
				</Transitions>
			</Setter>
		</Style>

		<!-- Menu Item Enhancements -->
		<Style Selector="MenuItem">
			<Setter Property="Padding" Value="12,8"/>
			<Setter Property="Margin" Value="0,1"/>
			<Setter Property="CornerRadius" Value="4"/>
		</Style>

		<Style Selector="MenuItem:selected">
			<Setter Property="Background" Value="{DynamicResource HoverBackgroundBrush}"/>
		</Style>

		<!-- Dock Control Enhancements -->
		<Style Selector="DockControl">
			<Setter Property="Background" Value="{DynamicResource AppBackgroundBrush}"/>
		</Style>

		<!-- Theme transition animations -->
		<Style Selector="Window">
			<Setter Property="Transitions">
				<Transitions>
					<BrushTransition Property="Background" Duration="0:0:0.3"/>
				</Transitions>
			</Setter>
		</Style>

		<Style Selector="Border">
			<Setter Property="Transitions">
				<Transitions>
					<BrushTransition Property="Background" Duration="0:0:0.3"/>
					<BrushTransition Property="BorderBrush" Duration="0:0:0.3"/>
				</Transitions>
			</Setter>
		</Style>

		<Style Selector="TextBlock">
			<Setter Property="Transitions">
				<Transitions>
					<BrushTransition Property="Foreground" Duration="0:0:0.3"/>
				</Transitions>
			</Setter>
		</Style>
	</Window.Styles>

</Window>